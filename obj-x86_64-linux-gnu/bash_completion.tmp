#!/bin/bash
# Bash completion for ak

_ak_completion() {
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    # Main commands
    local commands="set get ls rm search cp purge save load unload profiles env export import migrate run guard test doctor audit install-shell uninstall completion version backend help welcome"

    case "${prev}" in
        ak)
            COMPREPLY=($(compgen -W "${commands}" -- ${cur}))
            return 0
            ;;
        --profile|-p)
            # Complete with available profiles
            local profiles=$(ak profiles 2>/dev/null | tr '\n' ' ')
            COMPREPLY=($(compgen -W "${profiles}" -- ${cur}))
            return 0
            ;;
        --format|-f)
            COMPREPLY=($(compgen -W "env dotenv json yaml" -- ${cur}))
            return 0
            ;;
        completion)
            COMPREPLY=($(compgen -W "bash zsh fish" -- ${cur}))
            return 0
            ;;
        guard)
            COMPREPLY=($(compgen -W "enable disable" -- ${cur}))
            return 0
            ;;
        test)
            local services="anthropic azure_openai brave cohere deepseek exa fireworks gemini groq huggingface mistral openai openrouter perplexity sambanova tavily together xai"
            COMPREPLY=($(compgen -W "${services} --all --json --fail-fast" -- ${cur}))
            return 0
            ;;
    esac

    # Global flags
    local global_flags="--json --help --version"
    COMPREPLY=($(compgen -W "${global_flags}" -- ${cur}))
}

complete -F _ak_completion ak
